name: Neuro-Gaming CI/CD

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  neuro-testing:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [18, 20]

    steps:
    - uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}

    - name: Install Node.js dependencies
      run: npm ci

    - name: Run JavaScript tests
      run: npm test

    - name: Lint JavaScript code
      run: npm run lint

    - name: Run neuro-specific tests
      run: |
        npm run test:neuro

    - name: Security scan
      run: |
        npm audit --audit-level moderate

    - name: Upload coverage reports
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage/lcov.info
        flags: unittests
        name: neuro-gaming-ci

  neuro-simulation:
    runs-on: ubuntu-latest
    needs: neuro-testing

    steps:
    - uses: actions/checkout@v3

    - name: Run neuro-simulations
      run: |
        node neuro/simulations/eeg_simulation.js
        node neuro/simulations/emotional_detection_simulation.js
        node neuro/simulations/ai_integration_simulation.js

    - name: Generate neuro-report
      run: |
        node neuro/reporting/generate_ci_report.js
        mv neuro_report.html ${{ github.workspace }}/

    - name: Upload neuro-report
      uses: actions/upload-artifact@v3
      with:
        name: neuro-simulation-report
        path: ${{ github.workspace }}/neuro_report.html

  deploy-docs:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    needs: [neuro-testing, neuro-simulation]

    steps:
    - uses: actions/checkout@v3

    - name: Deploy documentation
      run: |
        mkdir -p docs/_build
        node generate_docs.js
        # Deploy to GitHub Pages
        # (Implementation depends on your doc system)